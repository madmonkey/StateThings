@* RequestForm Details Page *@
@model StateInterface.Areas.Design.Models.RequestFormModel
<div class="row">
    <div class="col-xs-12">
        @* This is so that the navigation lines up when the recordsCenterSelector is not part of the page *@
        <div class="recordsCenterSelectorPlaceHolder"></div>
    </div>
</div>
<div class="row">
    <div class="col-xs-12">
        <ol class="breadcrumb">
            <li><a data-bind="attr: { href: DesignHomeUrl }">Design</a></li>
            <li><a data-bind="attr: { href: FormsHomeUrl }">Forms</a></li>
            <li class="active"><span data-bind="html: FormId"></span></li>
        </ol>
        <div class="padLeft padRight">
            <div data-bind="template: { name: 'properties-template' }"></div>
            <div data-bind="template: { name: 'fields-template' }"></div>
            <div data-bind="template: { name: 'transactions-template' }"></div>
        </div>
    </div>
</div>

<div class="modal fade" data-bind="bootstrapShowModal: applicationAssociationModal" role="dialog">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <a class="close" data-dismiss="modal" aria-hidden="true">×</a>
                <h3>Application Association <span data-bind="html: FormId"></span></h3>
            </div>
            <form role="form">
                <div class="modal-body">
                    <span class="leadSmaller">Please select the applications that use this form</span>
                    <table style="width:100%;">
                        <tr class="bold leadSmaller" data-bind="foreach: ApplicationsForEdit">
                            <td>
                                <span><input type="checkbox" data-bind="checked: IsSelected"></span>
                                <span data-bind="html: Name"></span>
                            </td>
                        </tr>
                    </table>
                </div>
                <div class="modal-footer">
                    <a href="#" data-dismiss="modal" class="btn btn-primary" data-bind="click: saveApplications">Save</a>
                    <a class="btn btn-default" data-dismiss="modal">Cancel</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script type="text/html" id="properties-template">
    <div class="row">
        <div class="col-xs-12">
            <div class="padHeader" style="padding-bottom: 0">
                <span class="leadLarger" data-bind="html:FormId"></span>
                <span class="leadSmaller" data-bind="html: Title"></span><span class="leadSmaller">, v</span><span class="leadSmaller" data-bind="html: Version"></span>

                <div class="pull-right">
                    <a target="_blank" title="Preview Form" class="padRight glyphicon glyphicon-eye-open" style="margin-top:14px;" data-bind="attr:{ href: PreviewFormUrl() }"></a>
                    <a target="_blank" class="glyphicon glyphicon-question-sign" title="Help" href="@Url.Action("Help")"></a>
                </div>
            </div>
            <div class="leadSmaller">
                <span data-bind="html: Description"></span>
            </div>
            <br />
            <div class="leadSmaller">
                <span>Submission Mode:</span>
                <span data-bind="html: SubmissionMode"></span>
            </div>
            <div class="leadSmaller">
                <span>Categories:</span>
                <span data-bind="foreach: Associations">
                    <span data-bind="html: Name"></span>
                </span>
            </div>
            <div class="leadSmaller">
                <span>Applications:</span>
                <span data-bind="foreach: Applications">
                    <span data-bind="html: Name, visible: IsSelected"></span>
                </span>
                <a href="#" title="Update Association" class="glyphicon glyphicon-edit padLeft" data-bind="visible: CanDesignManage, click: updateApplications"></a>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="fields-template">
    <div class="row">
        <div class="col-xs-12">
            <div class="panel-group" data-bind="attr: { id: 'accordian_fields' }">
                <h2 class="pull-left">
                    <a class="pull-left glyphicon glyphicon-collapse-down" style="margin-top: 5px" data-toggle="collapse" data-bind="attr:{ 'data-parent': 'accordian_fields', href: '#collapse_fields' }"></a>
                    <span>&nbsp;Fields</span>
                </h2>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="panel-collapse collapse in" data-bind="attr: { id: 'collapse_fields' }">
                        <table class="fieldTable">
                            <thead>
                                <tr class="fieldPropertiesTableHeader">
                                    <td></td>
                                    <th>
                                        <span class="fieldPropertiesColumnHeader">Type</span>
                                    </th>
                                    <th>
                                        <span class="fieldPropertiesColumnHeader">Length</span>
                                    </th>
                                    <th>
                                        <span class="fieldPropertiesColumnHeader">Frequency</span>
                                    </th>
                                    <th>
                                        <span class="fieldPropertiesColumnHeader">Separator</span>
                                    </th>
                                    <th>
                                        <span class="fieldPropertiesColumnHeader">Prefix</span>
                                    </th>
                                    <th>
                                        <span class="fieldPropertiesColumnHeader">Suffix</span>
                                    </th>
                                    <th>
                                        <span class="fieldPropertiesColumnHeader">Value</span>
                                    </th>
                                </tr>
                                <tr style="height:10px"></tr>
                            </thead>
                            <tbody data-bind="foreach: FormFields">
                                <tr class="propertiesRow" style="vertical-align:top">
                                    <td>
                                        <div>
                                            <a target="_blank" data-bind="attr: { href: FieldDetailsUrl }">
                                                <span class="formFieldName" data-bind="html: Name"></span>
                                            </a>
                                            <span class="formFieldTooltip" data-bind="html: Tooltip"></span>
                                            <div class="additionalFieldDetails" data-bind="visible: OptionListName().length > 0">
                                                <a target="_blank" data-bind="attr: { href: ListDetailsUrl }">
                                                    <span data-bind="html: OptionListName"></span>
                                                    <span>list</span>
                                                </a>
                                            </div>
                                            <div class="additionalFieldDetails" data-bind="visible: IsHiddenField">
                                                <span>Hidden</span>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="fieldPropertiesContent" data-bind="html: Type"></span>
                                    </td>
                                    <td>
                                        <span class="fieldPropertiesContent" data-bind="html: Length"></span>
                                    </td>
                                    <td>
                                        <span class="fieldPropertiesContent" data-bind="html: Frequency"></span>
                                    </td>
                                    <td>
                                        <span class="fieldPropertiesContent" data-bind="html: Separator"></span>
                                    </td>
                                    <td>
                                        <span class="fieldPropertiesContent" data-bind="html: Prefix"></span>
                                    </td>
                                    <td>
                                        <span class="fieldPropertiesContent" data-bind="html: Suffix"></span>
                                    </td>
                                    <td>
                                        <span class="fieldPropertiesContent" data-bind="html: DefaultValue"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="transactions-template">
    <div class="row">
        <div class="col-xs-12">
            <div class="panel-group" data-bind="attr: { id: 'accordian_transactions' }">
                <h2 class="pull-left">
                    <a class="pull-left glyphicon glyphicon-collapse-down" style="margin-top: 5px" data-toggle="collapse" data-bind="attr:{ 'data-parent': 'accordian_transactions', href: '#collapse_transactions' }"></a>
                    &nbsp;Transactions
                </h2>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <div class="panel-collapse collapse in" data-bind="attr: { id: 'collapse_transactions' }">
                    <div class="panel-body">
                        <div class="padLeft">
                            <div data-bind="foreach: Transactions">
                                <h3 data-bind="html: Name"></h3>
                                <div data-bind="foreach: TxNodes">
                                    <span data-bind="css: { fieldNode: IsField, textNode: !IsField() }"><span class="leadSmaller" data-bind="html: DisplayValue"></span></span>
                                </div>
                                <div data-bind="template: { name: 'criteria-template' }"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="criteria-template">
    <div class="row">
        <div class="col-xs-12">
            <div style="margin-left:30px;">
                <div class="row">
                    <div>
                        <div class="padLeft leadSmaller" data-bind="foreach: Criteria">
                            <h4 data-bind="html: Name"></h4>
                            <div class="col-xs-12">
                                <div class="col-xs-2 pull-left">
                                    <p class="leadsmaller">Required:</p>
                                </div>

                                <div class="col-xs-10 pull-left" data-bind="foreach: RequiredFields">
                                    <span class="leadSmaller" data-bind="html: Name"></span>
                                </div>
                            </div>
                            <div class="col-xs-12" data-bind="visible: ConditionalFields().length > 0">
                                <div class="col-xs-2 pull-left">
                                    <p class="leadSmaller">Conditional:</p>
                                </div>

                                <div class="col-xs-10 pull-left" data-bind="foreach: ConditionalFields">
                                    <span class="leadSmaller" data-bind="html: Name"></span>
                                    <span class="leadSmaller" data-bind="html: Condition"></span>
                                    <span class="leadSmaller" data-bind="html: CheckValue"></span>
                                </div>
                            </div>
                            <div class="col-xs-12" data-bind="visible: OptionalFields().length > 0">
                                <div class="col-xs-2 pull-left">
                                    <p class="leadSmaller">Optional:</p>
                                </div>

                                <div class="col-xs-10 pull-left" data-bind="foreach: OptionalFields">
                                    <span class="leadSmaller" data-bind="html: Name"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/javascript">
    var initialData = @Html.Raw(Model.InitialData)
</script>

@section scripts{
    @Scripts.Render("~/bundles/stateinterface_design_form_details")
}